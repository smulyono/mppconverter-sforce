@isTest
private class Test_Project {

	@isTest
    static void test_method_one() {
        String json_test = '{"projectTitle": "Children\'s Book Schedule","publisher": ""';
        json_test += ',"resources": [{"name":"resource1","type":"work", "stdRate":52.2, "uniqueId" : 1}, {"name":"resource2", "type":"WORK", "stdRate":38.74999999, "id": 3, "uniqueId": 2}]';
        json_test += ',"tasks" : [{"name":"Editorial Staff Meeting 1", "uniqueId" : 1, "milestone" : false},{"name":"Editorial Staff Meeting 2", "uniqueId" : 2, "active" : true},{"name":"Editorial Staff Meeting 3", "uniqueId" : 3, "milestone" : true}]';
        json_test += ',"assignments" : [{"taskUniqueId":1, "resourceUniqueId" : 2}, {"taskUniqueId" : 3, "resourceUniqueId" : 1}]}';

        Test.startTest();
        projectModel.Project result = (projectModel.Project)JSON.deserialize(json_test, projectModel.Project.class);
        system.assert(result != null);
        system.assert(result.projectTitle.equals('Children\'s Book Schedule'));

        system.assert(result.resources.size() == 2, 'Wrong count of resources!');

        system.assert(result.tasks.size() ==3, 'Wrong count of tasks!' );

        system.assert(result.assignments.size() == 2, 'Wrong count of assignments!');

        // Test static class -- failure expected
        result = importProjectController.operateJSON(json_test);

        system.assert(result != null);
        system.assert(result.projectTitle.equals('Children\'s Book Schedule'));
        system.assert(result.generatedId == null);

        // Test with MPP sample
        json_test='{"projectTitle":"Children\'s Book Schedule","publisher":"","resources":[{"name":"Unassigned Resource","type":"WORK","stdRate":0,"id":0,"uniqueId":0},{"name":"Carole Poland","type":"WORK","stdRate":52.5,"id":1,"uniqueId":1},{"name":"Copyeditors","type":"WORK","stdRate":45,"id":3,"uniqueId":2},{"name":"Dan Jump","type":"WORK","stdRate":75.5,"id":4,"uniqueId":3},{"name":"Hany Morcos","type":"WORK","stdRate":38.74999999999999,"id":5,"uniqueId":4},{"name":"Jane Dow","type":"WORK","stdRate":55,"id":6,"uniqueId":5},{"name":"Jun Cao","type":"WORK","stdRate":22,"id":7,"uniqueId":7},{"name":"Luis Sousa","type":"WORK","stdRate":70,"id":8,"uniqueId":9},{"name":"Printing Service","type":"WORK","stdRate":0,"id":9,"uniqueId":10},{"name":"Travel","type":"COST","stdRate":0,"id":11,"uniqueId":14},{"name":"Tad Orman","type":"WORK","stdRate":0,"id":10,"uniqueId":19},{"name":"Color Setting Services","type":"WORK","stdRate":0,"id":2,"uniqueId":20},{"name":"Bound galley proof","type":"MATERIAL","stdRate":15,"id":12,"uniqueId":21}],"tasks":[{"name":"Children\'s Book Schedule","id":0,"uniqueId":0,"milestone":false,"active":true,"percentageComplete":50},{"name":"Editorial staff meeting","id":1,"uniqueId":59,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 1","id":2,"uniqueId":60,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 2","id":3,"uniqueId":61,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 3","id":4,"uniqueId":62,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 4","id":5,"uniqueId":63,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 5","id":6,"uniqueId":64,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 6","id":7,"uniqueId":65,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 7","id":8,"uniqueId":66,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 8","id":9,"uniqueId":67,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 9","id":10,"uniqueId":68,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 10","id":11,"uniqueId":69,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 11","id":12,"uniqueId":70,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 12","id":13,"uniqueId":71,"milestone":false,"active":true,"percentageComplete":100},{"name":"Editorial staff meeting 13","id":14,"uniqueId":72,"milestone":false,"active":true,"percentageComplete":100},{"name":"Acquisition","id":15,"uniqueId":3,"milestone":false,"active":true,"percentageComplete":100},{"name":"Manuscript received","id":16,"uniqueId":4,"milestone":true,"active":true,"percentageComplete":100},{"name":"Content edit","id":17,"uniqueId":5,"milestone":false,"active":true,"percentageComplete":100},{"name":"Original art review","id":18,"uniqueId":80,"milestone":false,"active":true,"percentageComplete":100},{"name":"Author review of content edit","id":19,"uniqueId":6,"milestone":false,"active":true,"percentageComplete":100},{"name":"Handoff to Editorial","id":20,"uniqueId":7,"milestone":true,"active":true,"percentageComplete":100},{"name":"Editorial","id":21,"uniqueId":13,"milestone":false,"active":true,"percentageComplete":100},{"name":"Organize manuscript for copyedit","id":22,"uniqueId":8,"milestone":false,"active":true,"percentageComplete":100},{"name":"Copyedit","id":23,"uniqueId":9,"milestone":false,"active":true,"percentageComplete":100},{"name":"Author review of copyedit","id":24,"uniqueId":10,"milestone":false,"active":true,"percentageComplete":100},{"name":"Copyedit incorp","id":25,"uniqueId":11,"milestone":false,"active":true,"percentageComplete":100},{"name":"Handoff to Production","id":26,"uniqueId":12,"milestone":true,"active":true,"percentageComplete":100},{"name":"Design and Production","id":27,"uniqueId":15,"milestone":false,"active":true,"percentageComplete":43},{"name":"Set pages","id":28,"uniqueId":14,"milestone":false,"active":true,"percentageComplete":100},{"name":"Interior illustration design","id":29,"uniqueId":29,"milestone":false,"active":true,"percentageComplete":100},{"name":"1st Pages review","id":30,"uniqueId":16,"milestone":false,"active":true,"percentageComplete":0},{"name":"Proofread and index","id":31,"uniqueId":17,"milestone":false,"active":true,"percentageComplete":0},{"name":"Incorporate 1st Pages review","id":32,"uniqueId":18,"milestone":false,"active":true,"percentageComplete":0},{"name":"Send proofed pages to Production","id":33,"uniqueId":19,"milestone":true,"active":true,"percentageComplete":0},{"name":"Enter page corrections and index","id":34,"uniqueId":20,"milestone":false,"active":true,"percentageComplete":0},{"name":"Cover design","id":35,"uniqueId":21,"milestone":false,"active":true,"percentageComplete":0},{"name":"2nd Pages review","id":36,"uniqueId":22,"milestone":false,"active":true,"percentageComplete":0},{"name":"Proof and review","id":37,"uniqueId":81,"milestone":false,"active":true,"percentageComplete":0},{"name":"Send proofed pages to Production","id":38,"uniqueId":24,"milestone":true,"active":true,"percentageComplete":0},{"name":"Final review","id":39,"uniqueId":25,"milestone":false,"active":true,"percentageComplete":0},{"name":"Design book\'s companion website","id":40,"uniqueId":33,"milestone":false,"active":true,"percentageComplete":0},{"name":"Create mockup","id":41,"uniqueId":32,"milestone":false,"active":true,"percentageComplete":0},{"name":"Review with author","id":42,"uniqueId":31,"milestone":false,"active":true,"percentageComplete":0},{"name":"Color prep and printing","id":43,"uniqueId":30,"milestone":false,"active":true,"percentageComplete":0},{"name":"Send to color house","id":44,"uniqueId":26,"milestone":false,"active":true,"percentageComplete":0},{"name":"Generate proofs","id":45,"uniqueId":27,"milestone":false,"active":true,"percentageComplete":0},{"name":"Print and ship","id":46,"uniqueId":28,"milestone":false,"active":true,"percentageComplete":0},{"name":"Book launch prep","id":47,"uniqueId":73,"milestone":false,"active":true,"percentageComplete":0},{"name":"Launch planning","id":48,"uniqueId":74,"milestone":false,"active":true,"percentageComplete":0},{"name":"Assign launch team members","id":49,"uniqueId":75,"milestone":false,"active":true,"percentageComplete":0},{"name":"Complete author questionnaire","id":50,"uniqueId":76,"milestone":false,"active":true,"percentageComplete":0},{"name":"Schedule author interviews","id":51,"uniqueId":77,"milestone":false,"active":true,"percentageComplete":0},{"name":"Design and order marketing material","id":52,"uniqueId":78,"milestone":false,"active":true,"percentageComplete":0}],"assignments":[{"taskId":16,"resourceId":null,"taskUniqueid":4,"resourceUniqueid":-65535},{"taskId":20,"resourceId":1,"taskUniqueid":7,"resourceUniqueid":1},{"taskId":24,"resourceId":10,"taskUniqueid":10,"resourceUniqueid":19},{"taskId":25,"resourceId":1,"taskUniqueid":11,"resourceUniqueid":1},{"taskId":26,"resourceId":5,"taskUniqueid":12,"resourceUniqueid":4},{"taskId":31,"resourceId":10,"taskUniqueid":17,"resourceUniqueid":19},{"taskId":32,"resourceId":5,"taskUniqueid":18,"resourceUniqueid":4},{"taskId":33,"resourceId":5,"taskUniqueid":19,"resourceUniqueid":4},{"taskId":34,"resourceId":6,"taskUniqueid":20,"resourceUniqueid":5},{"taskId":35,"resourceId":8,"taskUniqueid":21,"resourceUniqueid":9},{"taskId":38,"resourceId":5,"taskUniqueid":24,"resourceUniqueid":4},{"taskId":44,"resourceId":5,"taskUniqueid":26,"resourceUniqueid":4},{"taskId":17,"resourceId":1,"taskUniqueid":5,"resourceUniqueid":1},{"taskId":19,"resourceId":10,"taskUniqueid":6,"resourceUniqueid":19},{"taskId":19,"resourceId":3,"taskUniqueid":6,"resourceUniqueid":2},{"taskId":22,"resourceId":5,"taskUniqueid":8,"resourceUniqueid":4},{"taskId":23,"resourceId":3,"taskUniqueid":9,"resourceUniqueid":2},{"taskId":24,"resourceId":3,"taskUniqueid":10,"resourceUniqueid":2},{"taskId":28,"resourceId":6,"taskUniqueid":14,"resourceUniqueid":5},{"taskId":29,"resourceId":8,"taskUniqueid":29,"resourceUniqueid":9},{"taskId":31,"resourceId":3,"taskUniqueid":17,"resourceUniqueid":2},{"taskId":39,"resourceId":6,"taskUniqueid":25,"resourceUniqueid":5},{"taskId":39,"resourceId":5,"taskUniqueid":25,"resourceUniqueid":4},{"taskId":39,"resourceId":1,"taskUniqueid":25,"resourceUniqueid":1},{"taskId":45,"resourceId":2,"taskUniqueid":27,"resourceUniqueid":20},{"taskId":46,"resourceId":9,"taskUniqueid":28,"resourceUniqueid":10},{"taskId":41,"resourceId":8,"taskUniqueid":32,"resourceUniqueid":9},{"taskId":42,"resourceId":8,"taskUniqueid":31,"resourceUniqueid":9},{"taskId":42,"resourceId":10,"taskUniqueid":31,"resourceUniqueid":19},{"taskId":2,"resourceId":1,"taskUniqueid":60,"resourceUniqueid":1},{"taskId":2,"resourceId":7,"taskUniqueid":60,"resourceUniqueid":7},{"taskId":2,"resourceId":5,"taskUniqueid":60,"resourceUniqueid":4},{"taskId":3,"resourceId":1,"taskUniqueid":61,"resourceUniqueid":1},{"taskId":3,"resourceId":7,"taskUniqueid":61,"resourceUniqueid":7},{"taskId":3,"resourceId":5,"taskUniqueid":61,"resourceUniqueid":4},{"taskId":4,"resourceId":1,"taskUniqueid":62,"resourceUniqueid":1},{"taskId":4,"resourceId":7,"taskUniqueid":62,"resourceUniqueid":7},{"taskId":4,"resourceId":5,"taskUniqueid":62,"resourceUniqueid":4},{"taskId":5,"resourceId":1,"taskUniqueid":63,"resourceUniqueid":1},{"taskId":5,"resourceId":7,"taskUniqueid":63,"resourceUniqueid":7},{"taskId":5,"resourceId":5,"taskUniqueid":63,"resourceUniqueid":4},{"taskId":6,"resourceId":1,"taskUniqueid":64,"resourceUniqueid":1},{"taskId":6,"resourceId":7,"taskUniqueid":64,"resourceUniqueid":7},{"taskId":6,"resourceId":5,"taskUniqueid":64,"resourceUniqueid":4},{"taskId":7,"resourceId":1,"taskUniqueid":65,"resourceUniqueid":1},{"taskId":7,"resourceId":7,"taskUniqueid":65,"resourceUniqueid":7},{"taskId":7,"resourceId":5,"taskUniqueid":65,"resourceUniqueid":4},{"taskId":8,"resourceId":1,"taskUniqueid":66,"resourceUniqueid":1},{"taskId":8,"resourceId":7,"taskUniqueid":66,"resourceUniqueid":7},{"taskId":8,"resourceId":5,"taskUniqueid":66,"resourceUniqueid":4},{"taskId":9,"resourceId":1,"taskUniqueid":67,"resourceUniqueid":1},{"taskId":9,"resourceId":7,"taskUniqueid":67,"resourceUniqueid":7},{"taskId":9,"resourceId":5,"taskUniqueid":67,"resourceUniqueid":4},{"taskId":10,"resourceId":1,"taskUniqueid":68,"resourceUniqueid":1},{"taskId":10,"resourceId":7,"taskUniqueid":68,"resourceUniqueid":7},{"taskId":10,"resourceId":5,"taskUniqueid":68,"resourceUniqueid":4},{"taskId":11,"resourceId":1,"taskUniqueid":69,"resourceUniqueid":1},{"taskId":11,"resourceId":7,"taskUniqueid":69,"resourceUniqueid":7},{"taskId":11,"resourceId":5,"taskUniqueid":69,"resourceUniqueid":4},{"taskId":12,"resourceId":1,"taskUniqueid":70,"resourceUniqueid":1},{"taskId":12,"resourceId":7,"taskUniqueid":70,"resourceUniqueid":7},{"taskId":12,"resourceId":5,"taskUniqueid":70,"resourceUniqueid":4},{"taskId":13,"resourceId":1,"taskUniqueid":71,"resourceUniqueid":1},{"taskId":13,"resourceId":7,"taskUniqueid":71,"resourceUniqueid":7},{"taskId":13,"resourceId":5,"taskUniqueid":71,"resourceUniqueid":4},{"taskId":14,"resourceId":1,"taskUniqueid":72,"resourceUniqueid":1},{"taskId":14,"resourceId":7,"taskUniqueid":72,"resourceUniqueid":7},{"taskId":14,"resourceId":5,"taskUniqueid":72,"resourceUniqueid":4},{"taskId":41,"resourceId":5,"taskUniqueid":32,"resourceUniqueid":4},{"taskId":29,"resourceId":5,"taskUniqueid":29,"resourceUniqueid":4},{"taskId":48,"resourceId":1,"taskUniqueid":74,"resourceUniqueid":1},{"taskId":49,"resourceId":1,"taskUniqueid":75,"resourceUniqueid":1},{"taskId":50,"resourceId":5,"taskUniqueid":76,"resourceUniqueid":4},{"taskId":51,"resourceId":5,"taskUniqueid":77,"resourceUniqueid":4},{"taskId":52,"resourceId":5,"taskUniqueid":78,"resourceUniqueid":4},{"taskId":50,"resourceId":10,"taskUniqueid":76,"resourceUniqueid":19},{"taskId":48,"resourceId":6,"taskUniqueid":74,"resourceUniqueid":5},{"taskId":39,"resourceId":12,"taskUniqueid":25,"resourceUniqueid":21},{"taskId":18,"resourceId":5,"taskUniqueid":80,"resourceUniqueid":4},{"taskId":18,"resourceId":6,"taskUniqueid":80,"resourceUniqueid":5},{"taskId":2,"resourceId":4,"taskUniqueid":60,"resourceUniqueid":3},{"taskId":3,"resourceId":4,"taskUniqueid":61,"resourceUniqueid":3},{"taskId":4,"resourceId":4,"taskUniqueid":62,"resourceUniqueid":3},{"taskId":5,"resourceId":4,"taskUniqueid":63,"resourceUniqueid":3},{"taskId":6,"resourceId":4,"taskUniqueid":64,"resourceUniqueid":3},{"taskId":7,"resourceId":4,"taskUniqueid":65,"resourceUniqueid":3},{"taskId":8,"resourceId":4,"taskUniqueid":66,"resourceUniqueid":3},{"taskId":9,"resourceId":4,"taskUniqueid":67,"resourceUniqueid":3},{"taskId":10,"resourceId":4,"taskUniqueid":68,"resourceUniqueid":3},{"taskId":11,"resourceId":4,"taskUniqueid":69,"resourceUniqueid":3},{"taskId":12,"resourceId":4,"taskUniqueid":70,"resourceUniqueid":3},{"taskId":13,"resourceId":4,"taskUniqueid":71,"resourceUniqueid":3},{"taskId":14,"resourceId":4,"taskUniqueid":72,"resourceUniqueid":3},{"taskId":22,"resourceId":4,"taskUniqueid":8,"resourceUniqueid":3},{"taskId":25,"resourceId":4,"taskUniqueid":11,"resourceUniqueid":3},{"taskId":32,"resourceId":4,"taskUniqueid":18,"resourceUniqueid":3},{"taskId":34,"resourceId":4,"taskUniqueid":20,"resourceUniqueid":3},{"taskId":42,"resourceId":4,"taskUniqueid":31,"resourceUniqueid":3},{"taskId":50,"resourceId":11,"taskUniqueid":76,"resourceUniqueid":14},{"taskId":42,"resourceId":11,"taskUniqueid":31,"resourceUniqueid":14},{"taskId":37,"resourceId":5,"taskUniqueid":81,"resourceUniqueid":4}]}';

        result = importProjectController.operateJSON(json_test);

        system.assert(result != null);
        system.assert(result.projectTitle.equals('Children\'s Book Schedule'));

        // Test controller
        List<Project__c> newprojects = new List<Project__c>();
        Project__c newproject = new Project__c(name='new project test');
        newprojects.add(newproject);
        insert (newprojects);

        Task__c newtask = new Task__c(name='newtask', project__c = newproject.id);
        insert(newtask);

        Apexpages.standardSetController asst = new Apexpages.standardSetController(newprojects);
        importProjectController ipc = new importProjectController(asst);

        // Test Apex Webservice Class
        RestRequest req = new RestRequest();
        req.addParameter('projectid', newproject.id);

        RestContext.request = req;
        RestContext.response = new RestResponse();
        projectModel.project wsresult = exportProjectWS.convertProjectToJSON();
        system.assert(wsresult.projectTitle == newproject.name);

        // Test export project controller
        Apexpages.standardController ast = new Apexpages.standardController(newproject);
        exportProjectController epc = new exportProjectController(ast);

        Test.stopTest();
	}

}
